{% extends "control/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %}Editar Produto{% endblock title %}

{% block content %}
<div class="pt-3">
    <div class="container" style="max-width: 100%;">
        <div class="d-flex align-items-center">
            <a href="{% url 'cadastros:produtos' %}">
                <i class="fa-solid fa-chevron-left fs-4" style="color: black;"></i>
            </a>
            <h1 style="font-family: Inter; font-weight: 700; color: #2563EB; margin: 0px; padding: 0px;">Editar Produto</h1>
        </div>

<form method="post" id="produto-form" style="margin: 0px;">
    {% csrf_token %}
    {% crispy form %}
   
</form>

<div id="msg" class="mt-3"></div>

<script>
document.getElementById("produto-form").addEventListener("submit", function(e) {
    e.preventDefault(); // impede reload

    const form = this;
    const formData = new FormData(form);

    fetch("", {
        method: "POST",
        body: formData,
        headers: {
            "X-Requested-With": "XMLHttpRequest"
        }
    })
    .then(response => response.json())
    .then(data => {
        const msgDiv = document.getElementById("msg");

        if (data.success) {
            // redirecionar página
            // window.location.href = data.redirect_url;

            // ficar na página:
            msgDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
        } else {
            msgDiv.innerHTML = `<div class="alert alert-danger">Erro ao salvar. Verifique os campos.</div>`;
            console.log(data.errors);
        }
    })
    .catch(error => {
        console.error("Erro:", error);
    });
});
</script>

    </div>
</div>
{% endblock content %}
{% block footer %}{% endblock %}